<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>India Trip Map ‚Äî Admin (Edit & Export JSON)</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<style>
  html, body { height: 100%; margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial; }
  #app { display: grid; grid-template-columns: 1fr 320px; grid-template-rows: 56px 1fr; height: 100%; }
  header { grid-column: 1 / 3; display: flex; gap: 8px; align-items: center; padding: 8px 12px; border-bottom: 1px solid #eee; background: #fafafa; }
  header h1 { font-size: 15px; margin: 0 8px 0 0; font-weight: 600; color: #333; }
  select, input, button { height: 36px; border: 1px solid #ddd; border-radius: 8px; padding: 0 10px; font-size: 14px; }
  input[type="text"] { width: 360px; max-width: 60vw; }
  button { cursor: pointer; background: white; }
  .btn-primary { background: #111; color: #fff; border-color: #111; }
  #map { grid-column: 1 / 2; grid-row: 2 / 3; }
  aside { grid-column: 2 / 3; grid-row: 2 / 3; border-left: 1px solid #eee; display: flex; flex-direction: column; min-width: 280px; }
  .panel-head { padding: 10px 12px; border-bottom: 1px solid #f0f0f0; display:flex; align-items:center; gap:8px; }
  .panel-head input { flex:1; }
  .list { overflow: auto; }
  .empty { color: #777; font-size: 13px; padding: 16px; }
  .place { padding: 10px 12px; border-bottom: 1px solid #f5f5f5; display:flex; gap:8px; align-items: center; font-size: 14px;}
  .place .emoji { width: 22px; text-align: center; }
  .place .meta { flex: 1; }
  .place .meta .name { font-weight: 600; color:#222; }
  .place .meta .notes { color:#666; font-size:12px; }
  .actions { display:flex; gap:6px; }
  .legend { margin-left: auto; display:flex; gap:10px; align-items:center; font-size: 14px; }
  .legend span { display:inline-flex; align-items:center; gap:4px; color:#333; }
  .legend .dot { width: 18px; text-align:center; }
  .toolrow { margin-left:auto; display:flex; gap:8px; }
  .capital-label {
    background: rgba(255,255,255,0.85);
    padding: 1px 6px;
    border: 1px solid #e7e7e7;
    border-radius: 10px;
    font-size: 11px;
    color: #111;
    pointer-events:none;
    white-space: nowrap;
  }
  .small { font-size: 12px; color:#666; }
</style>
</head>
<body>
<div id="app">
  <header>
    <h1>India Trip Map ‚Äî Admin</h1>
    <select id="statusSel" title="Category">
      <option value="visited">Visited üìç</option>
      <option value="lite">Visited (Lite) ‚úàÔ∏è</option>
      <option value="stayed">Stayed üè°</option>
    </select>
    <input id="placeInput" type="text" placeholder="Type a place (e.g., Hampi, Karnataka) and press Enter" />
    <button id="addBtn" class="btn-primary">Add</button>
    <div class="legend" title="Legend">
      <span><span class="dot">üìç</span>Visited</span>
      <span><span class="dot">‚úàÔ∏è</span>Visited (Lite)</span>
      <span><span class="dot">üè°</span>Stayed</span>
    </div>
    <div class="toolrow">
      <button id="exportJsonBtn" title="Download a data/places.json you can commit">Export JSON</button>
      <button id="exportFullBtn" title="Download admin.html for backup">Export Admin HTML</button>
      <button id="backfillBtn" title="Fill missing state names for all places">Backfill States</button>
    </div>
  </header>

  <div id="map"></div>

  <aside>
    <div class="panel-head">
      <input id="filterInput" type="text" placeholder="Filter list‚Ä¶" />
      <span class="small" id="count"></span>
    </div>
    <div class="list" id="list"></div>
  </aside>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
  const map = L.map('map', { minZoom:4, maxZoom:18 });
  L.tileLayer('https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png', {
    attribution:
